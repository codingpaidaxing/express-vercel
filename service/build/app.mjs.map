{"version":3,"sources":["../node_modules/.pnpm/registry.npmmirror.com+tsup@6.6.3_typescript@4.9.5/node_modules/tsup/assets/esm_shims.js","../src/app.ts","../src/routes/users.ts","../src/utils/index.ts","../src/routes/chatgpt/index.ts","../src/chatgpt/index.ts","../src/utils/is.ts","../src/chatgpt/middleware/auth.ts","../src/chatgpt/middleware/limiter.ts"],"sourcesContent":["// Shim globals in esm bundle\nimport { fileURLToPath } from 'url'\nimport path from 'path'\n\nconst getFilename = () => fileURLToPath(import.meta.url)\nconst getDirname = () => path.dirname(getFilename())\n\nexport const __dirname = /* @__PURE__ */ getDirname()\nexport const __filename = /* @__PURE__ */ getFilename()\n","// src/app.ts\nimport express, { Request, Response } from 'express';\nimport { isNotEmptyString } from './utils/is'\nimport usersRouter from './routes/users';\nimport chatRouter from './routes/chatgpt/index';\nimport path from 'path';\n\nconst app = express();\n// 设置静态文件目录\napp.use(express.static(path.join(__dirname, 'public')));\n// 文件中正确使用了 express.json() 中间件来解析请求体 不配置这个可能会无法获取 req.body\napp.use(express.json());\nconst router = express.Router()\n\nconst port = 3003;\n\n// app.use('/', indexRouter);\napp.use('/users', usersRouter);\napp.use('/chat', chatRouter);\n\n\napp.get('/', (req: Request, res: Response) => {\n  res.send('Hello, TypeScript Express!');\n});\n\n\napp.listen(port, () => {\n  console.log(`Server is running on http://localhost:${port}`);\n});\n","import express, { Request, Response } from 'express';\n// 通过命令 npm i sha1 安装 sha1\nimport sha1 from 'sha1';\n\nimport axios from 'axios';\nimport config from '../config/index';\nimport { sendResponse } from '../utils'\nconst router = express.Router();\n// const { appid, secret } = config;\n\nconst appid = process.env.WX_APPID\nconst secret = process.env.WX_SECRET\n\nrouter.post('/wx-user', async function (req, res, next) {\n  // 1. 获取当前页面 URL中的code\n  const code: string = req.query.code as string;\n  console.log('code:', code);\n  const user_info = await getWxUser(code);\n  console.log(\"============H5个人信息接口================\")\n  console.log({data: { wx_token: \"token_paidaxing\", user_info: user_info.data }})\n  res.send({ status: 'Success', message: '', data: { wx_token: \"token_paidaxing\", user_info: user_info.data } })\n});\n\n/* GET users listing. */\nasync function getWxUser(code: string) {\n  // 2. 通过code换取网页授权access_token 和 openid  userAccessToken\n  const result = await userAccessTokenByCode(code);\n  const access_token = result.data.access_token;\n  const openid = result.data.openid\n  console.log('access_token', access_token)\n  console.log('openid', openid)\n  // 3. 根据access_token 和 openid获取用户信息\n  const userInfoData = await userInfoByAccessTokenAndOpenId(access_token, openid);\n  console.log(\"userInfo:\", userInfoData.data);\n  return userInfoData;\n};\n\n\n/* GET users listing. */\nrouter.get('/', async function (req, res, next) {\n  // 1. 获取当前页面 URL中的code\n  const code: string = req.query.code as string;\n  // 2. 通过code换取网页授权access_token 和 openid  userAccessToken\n  const result = await userAccessTokenByCode(code);\n  const access_token = result.data.access_token;\n  const openid = result.data.openid\n  // 3. 根据access_token 和 openid获取用户信息\n  const userInfoData = await userInfoByAccessTokenAndOpenId(access_token, openid);\n  console.log(\"userInfo:\", userInfoData.data);\n  res.send(userInfoData.data);\n});\n\n// 通过code换取网页授权access_token\nasync function userAccessTokenByCode(code: string) {\n  try {\n    // 替换以下链接中的参数为实际值\n    var access_token_url = `https://api.weixin.qq.com/sns/oauth2/access_token?appid=${appid}&secret=${secret}&code=${code}&grant_type=authorization_code`;\n    let access_token_data = await axios.get(access_token_url);\n    console.log('access_token_data', access_token_data)\n    let access_token = access_token_data.data.access_token;\n    let openid = access_token_data.data.openid;\n\n    // 拉取用户信息\n    let user_info_url = `https://api.weixin.qq.com/sns/userinfo?access_token=${access_token}&openid=${openid}&lang=zh_CN`;\n    console.log(\"user_info_url\", user_info_url);\n\n    return sendResponse({\n      type: 'Success',\n      data: access_token_data.data,\n    });\n  } catch (error: any) {\n    console.error('Error fetching access token:', error);\n    return sendResponse({\n      type: 'Fail',\n      message: error.message ?? 'Failed',\n    });\n  }\n};\n\n// 用户信息\nasync function userInfoByAccessTokenAndOpenId(access_token: string, openid: string) {\n  console.log(access_token, openid)\n  let user_info_url = `https://api.weixin.qq.com/sns/userinfo?access_token=${access_token}&openid=${openid}&lang=zh_CN`\n  // let user_info_url = `https://api.weixin.qq.com/cgi-bin/user/info?access_token=${access_token}&openid=${openid}&lang=zh_CN`;\n  console.log(\"获取用户的请求地址:\", user_info_url);\n  let result = axios.get(user_info_url);\n  return result;\n};\n\n\n\nrouter.get('/wx-auth', function (req, res, next) {\n  let { signature, timestamp, nonce, echostr } = req.query;\n  let token = 'paidaxing';\n  let array = [timestamp, nonce, token];\n  array.sort(); // 字典排序\n  let str = array.join('');\n  let resultStr = sha1(str) // 对字符串str进行sha1进行加密\n  if (resultStr === signature) {\n    res.set('Content-Type', 'text/plain')\n    res.send(echostr);\n  } else {\n    res.send('Error!!!!!!')\n  }\n});\n\n\n\nexport default router;","interface SendResponseOptions<T = any> {\n    type: 'Success' | 'Fail'\n    message?: string\n    data?: T\n  }\n  \n  export function sendResponse<T>(options: SendResponseOptions<T>) {\n    if (options.type === 'Success') {\n      return Promise.resolve({\n        message: options.message ?? null,\n        data: options.data ?? null,\n        status: options.type,\n      })\n    }\n  \n    // eslint-disable-next-line prefer-promise-reject-errors\n    return Promise.reject({\n      message: options.message ?? 'Failed',\n      data: options.data ?? null,\n      status: options.type,\n    })\n  }\n  ","import express from 'express'\nimport type { RequestProps } from '../../chatgpt/model'\nimport type { ChatMessage } from '../../chatgpt/index'\nimport { chatConfig, chatReplyProcess, currentModel } from '../../chatgpt/index'\nimport { auth } from '../../chatgpt/middleware/auth'\nimport { limiter } from '../../chatgpt/middleware/limiter'\nimport { isNotEmptyString } from '../../utils/is'\n\nconst router = express.Router()\n\n\nrouter.post('/chat-process', [auth, limiter], async (req, res) => {\n  // res.setHeader('Content-type', 'application/octet-stream')\n  res.setHeader('Content-type', 'text/event-stream')\n  // 在服务器端的响应头中设置 Cache-Control: no-cache 来确保不进行缓存。 确保浏览器和服务器没有对 SSE 请求进行缓存\n  res.setHeader('Cache-Control', 'no-cache');\n\n\n  try {\n    const { prompt, options = {}, systemMessage, temperature, top_p } = req.body as RequestProps\n    let firstChunk = true\n    await chatReplyProcess({\n      message: prompt,\n      lastContext: options,\n      process: (chat: ChatMessage) => {\n        res.write(firstChunk ? JSON.stringify(chat) : `\\n${JSON.stringify(chat)}`)\n        firstChunk = false\n      },\n      systemMessage,\n      temperature,\n      top_p,\n    })\n  }\n  catch (error) {\n    console.log('error:', error);\n    res.write(JSON.stringify(error))\n  }\n  finally {\n    res.end()\n  }\n})\n\n// router.post('/config', auth, async (req, res) => {\n//   try {\n//     const response = await chatConfig()\n//     res.send(response)\n//   }\n//   catch (error) {\n//     res.send(error)\n//   }\n// })\n\n// router.post('/session', async (req, res) => {\n//   try {\n//     const AUTH_SECRET_KEY = process.env.AUTH_SECRET_KEY\n//     const hasAuth = isNotEmptyString(AUTH_SECRET_KEY)\n//     res.send({ status: 'Success', message: '', data: { auth: hasAuth, model: currentModel() } })\n//   }\n//   catch (error) {\n//     res.send({ status: 'Fail', message: error.message, data: null })\n//   }\n// })\n\n// router.post('/verify', async (req, res) => {\n//   try {\n//     const { token } = req.body as { token: string }\n//     if (!token)\n//       throw new Error('Secret key is empty')\n\n//     if (process.env.AUTH_SECRET_KEY !== token)\n//       throw new Error('密钥无效 | Secret key is invalid')\n\n//     res.send({ status: 'Success', message: 'Verify successfully', data: null })\n//   }\n//   catch (error) {\n//     res.send({ status: 'Fail', message: error.message, data: null })\n//   }\n// })\n\n\nexport default router;","import * as dotenv from 'dotenv'\nimport 'isomorphic-fetch'\nimport type { ChatGPTAPIOptions, ChatMessage, SendMessageOptions } from 'chatgpt'\nimport { ChatGPTAPI, ChatGPTUnofficialProxyAPI } from 'chatgpt'\nimport { SocksProxyAgent } from 'socks-proxy-agent'\nimport httpsProxyAgent from 'https-proxy-agent'\nimport fetch from 'node-fetch'\nimport { sendResponse } from '../utils'\nimport { isNotEmptyString } from '../utils/is'\nimport type { ApiModel, ChatContext, ChatGPTUnofficialProxyAPIOptions, ModelConfig } from '../types'\nimport type { RequestOptions, SetProxyOptions, UsageResponse } from './types'\n\nconst { HttpsProxyAgent } = httpsProxyAgent\n\ndotenv.config()\n\nconst ErrorCodeMessage: Record<string, string> = {\n  401: '[OpenAI] 提供错误的API密钥 | Incorrect API key provided',\n  403: '[OpenAI] 服务器拒绝访问，请稍后再试 | Server refused to access, please try again later',\n  502: '[OpenAI] 错误的网关 |  Bad Gateway',\n  503: '[OpenAI] 服务器繁忙，请稍后再试 | Server is busy, please try again later',\n  504: '[OpenAI] 网关超时 | Gateway Time-out',\n  500: '[OpenAI] 服务器繁忙，请稍后再试 | Internal Server Error',\n}\n\nconst timeoutMs: number = !isNaN(+process.env.TIMEOUT_MS) ? +process.env.TIMEOUT_MS : 100 * 1000\nconst disableDebug: boolean = process.env.OPENAI_API_DISABLE_DEBUG === 'true'\n\nlet apiModel: ApiModel\nconst model = isNotEmptyString(process.env.OPENAI_API_MODEL) ? process.env.OPENAI_API_MODEL : 'gpt-3.5-turbo'\n\nif (!isNotEmptyString(process.env.OPENAI_API_KEY) && !isNotEmptyString(process.env.OPENAI_ACCESS_TOKEN))\n  throw new Error('Missing OPENAI_API_KEY or OPENAI_ACCESS_TOKEN environment variable')\n\nlet api: ChatGPTAPI | ChatGPTUnofficialProxyAPI\n\n(async () => {\n  // More Info: https://github.com/transitive-bullshit/chatgpt-api\n\n  if (isNotEmptyString(process.env.OPENAI_API_KEY)) {\n    const OPENAI_API_BASE_URL = process.env.OPENAI_API_BASE_URL\n\n    const options: ChatGPTAPIOptions = {\n      apiKey: process.env.OPENAI_API_KEY,\n      completionParams: { model },\n      debug: !disableDebug,\n    }\n\n    // increase max token limit if use gpt-4\n    if (model.toLowerCase().includes('gpt-4')) {\n      // if use 32k model\n      if (model.toLowerCase().includes('32k')) {\n        options.maxModelTokens = 32768\n        options.maxResponseTokens = 8192\n      }\n      else {\n        options.maxModelTokens = 8192\n        options.maxResponseTokens = 2048\n      }\n    }\n\n    if (isNotEmptyString(OPENAI_API_BASE_URL))\n      options.apiBaseUrl = `${OPENAI_API_BASE_URL}/v1`\n\n    setupProxy(options)\n\n    api = new ChatGPTAPI({ ...options })\n    apiModel = 'ChatGPTAPI'\n  }\n  else {\n    const options: ChatGPTUnofficialProxyAPIOptions = {\n      accessToken: process.env.OPENAI_ACCESS_TOKEN,\n      apiReverseProxyUrl: isNotEmptyString(process.env.API_REVERSE_PROXY) ? process.env.API_REVERSE_PROXY : 'https://ai.fakeopen.com/api/conversation',\n      model,\n      debug: !disableDebug,\n    }\n\n    setupProxy(options)\n\n    api = new ChatGPTUnofficialProxyAPI({ ...options })\n    apiModel = 'ChatGPTUnofficialProxyAPI'\n  }\n})()\n\nasync function chatReplyProcess(options: RequestOptions) {\n  const { message, lastContext, process, systemMessage, temperature, top_p } = options\n  try {\n    let options: SendMessageOptions = { timeoutMs }\n\n    if (apiModel === 'ChatGPTAPI') {\n      if (isNotEmptyString(systemMessage))\n        options.systemMessage = systemMessage\n      options.completionParams = { model, temperature, top_p }\n    }\n\n    if (lastContext != null) {\n      if (apiModel === 'ChatGPTAPI')\n        options.parentMessageId = lastContext.parentMessageId\n      else\n        options = { ...lastContext }\n    }\n\n    const response = await api.sendMessage(message, {\n      ...options,\n      onProgress: (partialResponse) => {\n        process?.(partialResponse)\n      },\n    })\n\n    return sendResponse({ type: 'Success', data: response })\n  }\n  catch (error: any) {\n    const code = error.statusCode\n    global.console.log(error)\n    if (Reflect.has(ErrorCodeMessage, code))\n      return sendResponse({ type: 'Fail', message: ErrorCodeMessage[code] })\n    return sendResponse({ type: 'Fail', message: error.message ?? 'Please check the back-end console' })\n  }\n}\n\nasync function fetchUsage() {\n  const OPENAI_API_KEY = process.env.OPENAI_API_KEY\n  const OPENAI_API_BASE_URL = process.env.OPENAI_API_BASE_URL\n\n  if (!isNotEmptyString(OPENAI_API_KEY))\n    return Promise.resolve('-')\n\n  const API_BASE_URL = isNotEmptyString(OPENAI_API_BASE_URL)\n    ? OPENAI_API_BASE_URL\n    : 'https://api.openai.com'\n\n  const [startDate, endDate] = formatDate()\n\n  // 每月使用量\n  const urlUsage = `${API_BASE_URL}/v1/dashboard/billing/usage?start_date=${startDate}&end_date=${endDate}`\n\n  const headers = {\n    'Authorization': `Bearer ${OPENAI_API_KEY}`,\n    'Content-Type': 'application/json',\n  }\n\n  const options = {} as SetProxyOptions\n\n  setupProxy(options)\n\n  try {\n    // 获取已使用量\n    const useResponse = await options.fetch(urlUsage, { headers })\n    if (!useResponse.ok)\n      throw new Error('获取使用量失败')\n    const usageData = await useResponse.json() as UsageResponse\n    const usage = Math.round(usageData.total_usage) / 100\n    return Promise.resolve(usage ? `$${usage}` : '-')\n  }\n  catch (error) {\n    global.console.log(error)\n    return Promise.resolve('-')\n  }\n}\n\nfunction formatDate(): string[] {\n  const today = new Date()\n  const year = today.getFullYear()\n  const month = today.getMonth() + 1\n  const lastDay = new Date(year, month, 0)\n  const formattedFirstDay = `${year}-${month.toString().padStart(2, '0')}-01`\n  const formattedLastDay = `${year}-${month.toString().padStart(2, '0')}-${lastDay.getDate().toString().padStart(2, '0')}`\n  return [formattedFirstDay, formattedLastDay]\n}\n\nasync function chatConfig() {\n  const usage = await fetchUsage()\n  const reverseProxy = process.env.API_REVERSE_PROXY ?? '-'\n  const httpsProxy = (process.env.HTTPS_PROXY || process.env.ALL_PROXY) ?? '-'\n  const socksProxy = (process.env.SOCKS_PROXY_HOST && process.env.SOCKS_PROXY_PORT)\n    ? (`${process.env.SOCKS_PROXY_HOST}:${process.env.SOCKS_PROXY_PORT}`)\n    : '-'\n  return sendResponse<ModelConfig>({\n    type: 'Success',\n    data: { apiModel, reverseProxy, timeoutMs, socksProxy, httpsProxy, usage },\n  })\n}\n\nfunction setupProxy(options: SetProxyOptions) {\n  if (isNotEmptyString(process.env.SOCKS_PROXY_HOST) && isNotEmptyString(process.env.SOCKS_PROXY_PORT)) {\n    const agent = new SocksProxyAgent({\n      hostname: process.env.SOCKS_PROXY_HOST,\n      port: process.env.SOCKS_PROXY_PORT,\n      userId: isNotEmptyString(process.env.SOCKS_PROXY_USERNAME) ? process.env.SOCKS_PROXY_USERNAME : undefined,\n      password: isNotEmptyString(process.env.SOCKS_PROXY_PASSWORD) ? process.env.SOCKS_PROXY_PASSWORD : undefined,\n    })\n    options.fetch = (url, options) => {\n      return fetch(url, { agent, ...options })\n    }\n  }\n  else if (isNotEmptyString(process.env.HTTPS_PROXY) || isNotEmptyString(process.env.ALL_PROXY)) {\n    const httpsProxy = process.env.HTTPS_PROXY || process.env.ALL_PROXY\n    if (httpsProxy) {\n      const agent = new HttpsProxyAgent(httpsProxy)\n      options.fetch = (url, options) => {\n        return fetch(url, { agent, ...options })\n      }\n    }\n  }\n  else {\n    options.fetch = (url, options) => {\n      return fetch(url, { ...options })\n    }\n  }\n}\n\nfunction currentModel(): ApiModel {\n  return apiModel\n}\n\nexport type { ChatContext, ChatMessage }\n\nexport { chatReplyProcess, chatConfig, currentModel }\n","export function isNotEmptyString(value: any): boolean {\n    return typeof value === 'string' && value.length > 0\n}\n\n","import { isNotEmptyString } from '../../utils/is'\n\nconst auth = async (req, res, next) => {\n  const AUTH_SECRET_KEY = process.env.AUTH_SECRET_KEY\n  if (isNotEmptyString(AUTH_SECRET_KEY)) {\n    try {\n      const Authorization = req.header('Authorization')\n      if (!Authorization || Authorization.replace('Bearer ', '').trim() !== AUTH_SECRET_KEY.trim())\n        throw new Error('Error: 无访问权限 | No access rights')\n      next()\n    }\n    catch (error) {\n      res.send({ status: 'Unauthorized', message: error.message ?? 'Please authenticate.', data: null })\n    }\n  }\n  else {\n    next()\n  }\n}\n\nexport { auth }\n","import { rateLimit } from 'express-rate-limit'\nimport { isNotEmptyString } from '../../utils/is'\n\nconst MAX_REQUEST_PER_HOUR = process.env.MAX_REQUEST_PER_HOUR\n\nconst maxCount = (isNotEmptyString(MAX_REQUEST_PER_HOUR) && !isNaN(Number(MAX_REQUEST_PER_HOUR)))\n  ? parseInt(MAX_REQUEST_PER_HOUR)\n  : 0 // 0 means unlimited\n\nconst limiter = rateLimit({\n  windowMs: 60 * 60 * 1000, // Maximum number of accesses within an hour\n  max: maxCount,\n  statusCode: 200, // 200 means success，but the message is 'Too many request from this IP in 1 hour'\n  message: async (req, res) => {\n    res.send({ status: 'Fail', message: 'Too many request from this IP in 1 hour', data: null })\n  },\n})\n\nexport { limiter }\n"],"mappings":"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","names":["express","express","process","options","options","router","express","path","express","router"]}