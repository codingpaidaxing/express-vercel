{"version":3,"sources":["../src/app.ts","../src/routes/users.ts","../src/config/index.ts","../src/utils/index.ts"],"sourcesContent":["// src/app.ts\nimport express, { Request, Response } from 'express';\nimport { isNotEmptyString } from './utils/is'\nimport usersRouter from './routes/users';\n\n\nconst app = express();\nconst router = express.Router()\n\nconst port = 3002;\n\n// app.use('/', indexRouter);\napp.use('/users', usersRouter);\n\n\napp.get('/', (req: Request, res: Response) => {\n  res.send('Hello, TypeScript Express!');\n});\n\n\napp.listen(port, () => {\n  console.log(`Server is running on http://localhost:${port}`);\n});\n","import express, { Request, Response } from 'express';\n// 通过命令 npm i sha1 安装 sha1\nimport sha1 from 'sha1';\n\nimport axios from 'axios';\nimport config from '../config/index';\nimport { sendResponse } from '../utils'\n\nconst router = express.Router();\nconst { appid, secret } = config;\n\n\nrouter.post('/wx-user', async function (req, res, next) {\n  console.log(\"============H5个人信息接口================\")\n  res.send({ status: 'Success', message: '', data: { wx_token: \"token_paidaxing\", user_info: {nickname: \"paidaxing\"} } })\n});\n\n\n/* GET users listing. */\nrouter.get('/', async function (req, res, next) {\n  // 1. 获取当前页面 URL中的code\n  const code: string = req.query.code as string;\n  // 2. 通过code换取网页授权access_token 和 openid  userAccessToken\n  const result = await userAccessTokenByCode(code);\n  const access_token = result.data.access_token;\n  const openid = result.data.openid\n  // 3. 根据access_token 和 openid获取用户信息\n  const userInfoData = await userInfoByAccessTokenAndOpenId(access_token, openid);\n  console.log(\"userInfo:\", userInfoData.data);\n  res.send(userInfoData.data);\n});\n\n// 通过code换取网页授权access_token\nasync function userAccessTokenByCode(code: string) {\n  try {\n    // 替换以下链接中的参数为实际值\n    var access_token_url = `https://api.weixin.qq.com/sns/oauth2/access_token?appid=${appid}&secret=${secret}&code=${code}&grant_type=authorization_code`;\n    let access_token_data = await axios.get(access_token_url);\n\n    let access_token = access_token_data.data.access_token;\n    let openid = access_token_data.data.openid;\n\n    // 拉取用户信息\n    let user_info_url = `https://api.weixin.qq.com/sns/userinfo?access_token=${access_token}&openid=${openid}&lang=zh_CN`;\n    console.log(\"user_info_url\", user_info_url);\n\n    return sendResponse({\n      type: 'Success',\n      data: access_token_data.data,\n    });\n  } catch (error: any) {\n    console.error('Error fetching access token:', error);\n    return sendResponse({\n      type: 'Fail',\n      message: error.message ?? 'Failed',\n    });\n  }\n};\n\n// 用户信息\nasync function userInfoByAccessTokenAndOpenId(access_token: string, openid: string) {\n  console.log(access_token, openid)\n  let user_info_url = `https://api.weixin.qq.com/sns/userinfo?access_token=${access_token}&openid=${openid}&lang=zh_CN`\n  // let user_info_url = `https://api.weixin.qq.com/cgi-bin/user/info?access_token=${access_token}&openid=${openid}&lang=zh_CN`;\n  console.log(\"获取用户的请求地址:\", user_info_url);\n  let result = axios.get(user_info_url);\n  return result;\n};\n\n\n\nrouter.get('/wx-auth', function (req, res, next) {\n  let { signature, timestamp, nonce, echostr } = req.query;\n  let token = 'paidaxing';\n  let array = [timestamp, nonce, token];\n  array.sort(); // 字典排序\n  let str = array.join('');\n  let resultStr = sha1(str) // 对字符串str进行sha1进行加密\n  if (resultStr === signature) {\n    res.set('Content-Type', 'text/plain')\n    res.send(echostr);\n  } else {\n    res.send('Error!!!!!!')\n  }\n});\n\n\n\nexport default router;","const config = {\n    appid: 'wx6361298f0e180aa1',\n    secret: '741d6da7a14325fa0f49bb07fc8ae41b',\n};\n\nexport default config;\n","interface SendResponseOptions<T = any> {\n    type: 'Success' | 'Fail'\n    message?: string\n    data?: T\n  }\n  \n  export function sendResponse<T>(options: SendResponseOptions<T>) {\n    if (options.type === 'Success') {\n      return Promise.resolve({\n        message: options.message ?? null,\n        data: options.data ?? null,\n        status: options.type,\n      })\n    }\n  \n    // eslint-disable-next-line prefer-promise-reject-errors\n    return Promise.reject({\n      message: options.message ?? 'Failed',\n      data: options.data ?? null,\n      status: options.type,\n    })\n  }\n  "],"mappings":"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","names":["express","express","router"]}